先週は、手数料率を考慮したトランザクションで支払われる手数料を最小限に抑えるための手法を紹介しました。
しかし、その手数料率はどうあるべきなのでしょうか？理想的には、お金を節約するためにできるだけ低く、
ユーザーの時間的な優先順位に応じたブロックのスポットを確保するのに十分な額であることです。

_手数料（率）推定_ の目標は、承認のための目標時間枠を、
トランザクションが支払うべき最小手数料率に変換することです。

手数料の推定を複雑にする１つは、ブロックスペースの生産が不規則であることです。
たとえば、ユーザーが１時間以内に販売者に支払いを行う必要があるとします。
この場合、ユーザーは10分毎にブロックがマイニングされることを期待しているため、
次の6ブロック以内のスポットを狙うでしょう。しかし、1つのブロックがマイニングされるのに
45分かかることも十分あり得ます。手数料の推定では、ユーザーが希望する緊急性や時間枠
（「仕事終わりまでに承認してほしい」など）と、ブロックスペースの供給量（ブロック数）を調整する必要があります。
多くの手数料推定は、時間に加えてブロック数で承認目標を表すことで、この課題に対処しています。

承認前ののトランザクションに関する情報がない場合は、
どのような手数料率のトランザクションがブロックに入る傾向があるかについて過去のデータを使用する単純な手数料推定を構築できます。
この推定ツールは、mempoolで承認を待っているトランザクションを認識しないため、
ブロックスペース需要の予期せぬ変動や、時折発生する長めのブロック間隔に対して非常に不正確になります。
もう１つの弱点は、マイナーが完全に管理する情報に依存していることです。
マイナーは、ブロックに偽の高手数料率のトランザクションを含めることで、手数料率を上げることができます。

幸いなことに、ブロックスペースの市場はブラインドオークションではありません。
[最初の記事][policy01]で、mempoolを保持し、ピアーツーピアのトランザクションリレーネットワークに参加することで、
ノードがユーザーの入札を確認することができることを紹介しました。
Bitcoin Coreの手数料推定ツールも、履歴データを使用して、
`n`ブロック以内に手数料率`f`でトランザクションが承認される確率を計算しますが、
特にノードが最初にトランザクションを発見した高さと承認された高さを追跡します。
この方法は、公開手数料市場の外で発生する活動を無視することで機能します。
マイナーが人為的に高い手数料率のトランザクションを自分のブロックに含めても、
承認される前に公にリレーされたトランザクションのデータのみを使用するため、
この手数料推定ツールが歪められることはありません。

また、トランザクションがブロックに選択される方法についての洞察もあります。
[以前の記事で][policy02]、ノードはインセンティブに適合するトランザクションを自分のmempoolに保持するために、
マイナーのポリシーをエミュレートすることを紹介しました。
このアイディアを発展させると、過去のデータだけを見るのではなく、
マイナーが行うであることをシミュレートする手数料推定ツールを構築することができます。
次の`n`ブロック以内にトランザクションを承認するために必要な手数料率を見つけるために、
手数料推定ツールは、ブロック構築アルゴリズムを使用して、
mempoolから次の`n`個のブロックテンプレートを予測し、
ブロック`n`に入る最後のトランザクションに勝つ手数料率を計算することができます。

明らかに、この手数料推定ツールのアプローチの有効性は、
自分のmempoolのコンテンツとマイナーのコンテンツの類似性に依存し、これは決して保証されるものではありません。
また、承認のために帯域外で手数料を支払うトランザクションなど、
マイナーが外的な動機によって含める可能性のあるトランザクションも認識できません。
また予測では、現時点から予測されたブロックが見つかるまでの間に
ブロードキャストされた追加のトランザクションも考慮する必要があります。
他のトランザクションを考慮し、予測されるブロックのサイズを減らすことでこれを実現できますが、
どれくらいでしょうか？

この質問は、履歴データの有用性を再び浮き彫りにします。
高度なモデルであれば、活動のパターンを組み込んで、典型的な営業時間や、
企業でスケージュールされたUTXOの統合、Bitcoinの取引価格の変化に応じた活動など、
手数料率に影響を与える外部イベントを考慮することができるかもしれません。
ブロックスペースの需要予測という問題は、まだ探求の余地があり、常にイノベーションの余地があると思われます。

手数料推定は多面的で難しい問題です。悪い手数料推定は、
手数料を過剰に支払うことで資金を浪費し、支払いにBitcoinを使用することに摩擦をもたらし、
別の使用条件を持つタイムロックされたUTXOがある期間を逃すことでL2ユーザーが損失を被る可能性があります。
良い手数料推定は、ユーザーがマイナーにトランザクションの緊急度を明確かつ正確に伝えることを可能にし、
[CPFP][topic cpfp]や[RBF][topic rbf]により、初期の見積もりが甘かった場合に入札の更新を可能にします。
インセンティブに適合するmempoolポリシーと、よく設計された手数料推定ツールと[ウォレット][policy03]を組み合わせることで、
ユーザーはブロックスペースの効率的な公開オークションに参加することができます。

手数料推定ツールは、時間軸がどれくらい長くても、承認待ちのトランザクションがどれくらい少なくても、
通常1sat/vBを下回る値を返すことはありません。
多くの人が1sat/vBをBitcoinネットワークの事実上の下限手数料率と考えています。
これは、（マイナーを含む）ネットワーク上のほとんどのノードが、
mempoolがどれだけ空いていても、この手数料率以下のものを[決して受け入れない][topic default minimum transaction relay feerates]という
事実があるためです。来週の記事では、このノードポリシーと、
トランザクションリレーで手数料率を利用するもう1つの動機であるリソースの枯渇からの保護について説明する予定です。

[policy01]: /ja/newsletters/2023/05/17/#承認を待つ-1-なぜmempoolがあるのか
[policy02]: /ja/newsletters/2023/05/24/#承認を待つ-2-インセンティブ
[policy03]: /ja/newsletters/2023/05/31/#承認を待つ-3-ブロックスペースの入札
