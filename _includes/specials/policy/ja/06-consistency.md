先週の記事では、コンセンサスルールに加えて適用されるトランザクションの検証ルールのセットである
ポリシーについて紹介しました。これらのルールは、ブロック内のトランザクションには適用されないため、
ノードのポリシーがピアと異なっていても、コンセンサスを維持することができます。
ノードオペレーターがトランザクションリレーに参加しないことを選択できるように、
どのようなポリシーを選択するかも自由で、全く選択しない（ノードがDoSのリスクにさらされる）ことも可能です。
つまり、ネットワーク全体でmempoolポリシーが完全に同一であるとは仮定できません。
しかし、ユーザーのトランザクションがマイナーに受信されるためには、
すべてのノードがそのトランザクションを自身のmempoolに受け入れる経路を通過する必要があり、
ノード間のポリシーの不一致はトランザクションリレーの機能に直接影響します。

ノード間のポリシーの違いの極端な例として、各ノードオペレーターがランダムな`nVersion`を選択し、
その`nVersion`のトランザクションのみを受け入れるという状況を想像してみてください。
ほとんどのピアツーピアの関係は互換性のないポリシーを持つことになるので、
トランザクションはマイナーまで伝播しません。

一方、ネットワーク全体で同一のポリシーがあれば、mempoolの内容を収束させることができます。
mempoolが一致するネットワークは、トランザクションを最もスムーズにリレーし、
これまでの記事で説明したように、[手数料の推定][policy04]や[コンパクトブロックリレー][policy01]にも最適です。

mempoolの検証の複雑さとポリシーの不一致から生じる困難を考慮し、
Bitcoin Coreは歴史的にポリシーの設定可能性に関して[保守的][aj mempool consistency]でした。
ユーザーは、sigopsのカウント方法（`bytespersigop`）を簡単に微調整したり、
`OP_RETURN`アウトプットに埋め込めるデータ量を制限したり（`datacarriersize`および`datacarrier`）できる一方で、
ソースコードを変更することなく、400,000 weight-unitの最大標準weightをオプトアウトしたり、
手数料関連のRBFルールに異なるセットを適用したりすることはできません。

Bitcoin Coreのポリシー設定オプションの中には、ノードの動作環境の違いや、
運用目的の違いに対応するためのものが存在します。たとえば、
マイナーのハードウェアリソースやmempoolを維持する目的は、
ラップトップやRaspberry Piで軽量ノードを実行する日常的なユーザーとは異なります。
マイナーはmempoolの容量（`maxmempool`）や有効期限のタイムライン（`mempoolexpiry`）を増やして
トラフィックピーク時の低手数料率のトランザクションを保存し、
トラフィックが落ち着いたときにそれらをマイニングするかもしれません。
可視化やアーカイブ、ネットワーク統計を提供するウェブサイトでは、
できるだけ多くのデータを収集するために複数のノードを実行し、
デフォルトのmempoolの動作を表示することもあります。

個々のノードでは、mempoolの容量の選択が手数料引き上げツールの可用性に影響します。
デフォルトのmempoolサイズを超えるトランザクションの送信により、
mempoolの最小手数料率が上昇すると、mempoolの「底」からパージされたトランザクションと、
この手数料率を下回る新しいトランザクションは、[CPFP][topic cpfp]を使って手数料を引き上げられなくなります。

一方、パージされたトランザクションによって使用されていたインプットは、
mempool内のどのトランザクションも使用していないので、
以前はできなかった [RBF][topic rbf]による手数料の引き上げが可能になるかもしれません。
新しいトランザクションは、ノードのmempool内の何かを実際に置き換えているわけではないので、
通常のRBFルールを考慮する必要はありません。しかし、（より大きなmempool容量を持つため）
元のトランザクションをパージしていないノードは、新しいトランザクションを提案された置換トランザクションとして扱い、
RBFルールへの準拠を要求します。パージされたトランザクションがBIP125の置換可能性をシグナルしていなかったり、
新しいトランザクションの手数料が高い手数料率にも関わらずRBFの要件を満たしていない場合、
マイナーはその新しいトランザクションを受け入れない可能性があります。
ウォレットはパージされたトランザクションを注意深く扱う必要があります。
トランザクションのアウトプットは使用可能とは見なせませんが、インプットは同様に再利用することはできません。

一見すると、より大きなmempool容量を持つノードは、CPFPの有用性が高くRBFの有用性が低いように見えるかもしれません。
しかし、トランザクションのリレーは、ネットワークの創発的な挙動に左右され、
ユーザーからマイナーまでCPFPを受け入れるノードの経路が存在しないかもしれません。
ノードは通常、トランザクションをmempoolに受け入れた時に一度だけそれをリレーし、
自分のmempoolに既に存在するトランザクションの通知を無視します。
より多くのトランザクションを格納するノードは、それらのトランザクションが再度ブロードキャストされたときに
[ブラックホールとして機能します][se maxmempool]。
ネットワーク全体がmempoolの容量を増やさない限り（デフォルト値を変更する変調）、
自分自身のmempoolの容量を増やすことで利益を得ることはほとんど期待できないでしょう。
デフォルトのmempoolの最小手数料率は、トラフィックピーク時にCPFPを使用することの有用性を制限しています。
サイズを拡大した自分のmempoolにCPFPトランザクションを送信できたユーザーは、
そのトランザクションが他の誰にも伝播していないことに気づかないかもしれません。

トランザクションリレーネットワークは、ネットワークに動的に参加および離脱する個々のノードで構成されており、
それぞれが悪用から身を守る必要があります。そのため、トランザクションリレーはベストエフォート型でしかなく、
すべてのノードがすべての未承認トランザクションを学習することを保証することはできません。
同時に、Bitcoinネットワークは、mempoolを可能な限り均質にするトランザクションリレーポリシーの1セットに収束すれば、
最高のパフォーマンスを発揮します。次の記事では、ネットワーク全体の利益に適合するために、
どのようなポリシーが採用されているかを探ります。

[policy01]: /ja/newsletters/2023/05/17/#承認を待つ-1-なぜmempoolがあるのか
[policy04]: /ja/newsletters/2023/06/07/#承認を待つ-4-手数料率の推定
[aj mempool consistency]: https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2022-October/021116.html
[se maxmempool]: https://bitcoin.stackexchange.com/questions/118137/how-does-it-contribute-to-the-bitcoin-network-when-i-run-a-node-with-a-bigger-th
