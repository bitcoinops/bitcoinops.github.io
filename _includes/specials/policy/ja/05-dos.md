私たちは、Bitcoinのプライバシーと検閲耐性の多くはネットワークの分散化された性質に起因していると述べて、
このシリーズを[始めました][policy01]。ユーザーが自分のノードを実行することで、
障害、監視、検閲の中心点を削減することができます。そのため、
Bitcoinノードソフトウェアの主な設計目標の１つは、ノードを実行するための高いアクセシビリティです。
各Bitcoinユーザーに、高価なハードウェアを購入したり、特定のオペレーティングシステムを使用したり、
また運用コストとして毎月数百ドルを費やすことを要求すると、ネットワーク上のノード数が減少する可能性が非常に高くなります。

さらに、Bitcoinネットワーク上のノードは、未知のエンティティへのインターネット接続を持つコンピュータであり、
ノードがメモリ不足に陥りクラッシュするようなメッセージを作成したり、
新しいブロックを受け入れるために意味のないデータに計算リソースや帯域幅を費やしたりすることで、
サービス拒否（DoS）攻撃を行う可能性があります。
これらのエンティティは設計上匿名であるため、ノードは接続前にそのピアが正直か悪意があるかを事前に判断することはできず、
攻撃が観測された後でも効果的に禁止することができません。したがって、
DoSから保護し、フルノードの実行コストを制限するポリシーを実装することは、単なる理想ではなく、必須なことです。

リソースの枯渇を防ぐために一般的なDoS保護がノードの実装に組み込まれています。
たとえば、Bitcoin Coreノードが１つのピアから多くのメッセージを受信した場合、
最初の１つだけを処理し、残りは他のピアのメッセージの後に処理されるようにワークキューに追加されます。
また、ノードは通常、ブロックをダウンロードして検証する前に、まずブロックヘッダーを最初にダウンロードし、
そのProof of Work（PoW）を検証します。したがって、ブロックリレーによってノードのリソースを枯渇させようとする攻撃者は、
まず有効なPoWを計算するために不釣り合いなほど膨大なリソースを費やす必要があります。
PoWの計算にかかる膨大なコストと検証にかかる些細なコストの非対称性により、
ブロックリレーにDoS耐性を組み込む自然な方法が提供されます。
この特性は、_未承認_ トランザクションのリレーには適用されません。

一般的なDoS保護では、ノードのコンセンサスエンジンがピアツーピアネットワークからの入力にさらされることを許容するだけの
十分な攻撃耐性を提供しません。[最大限の計算量を必要とする][max cpu tx]コンセンサスが有効なトランザクションを作ろうとする攻撃者は、
#364292 ブロックにあった1MBの[“メガトランザクション”][megatx mempool space]のようなものを送信するかもしれません。
このトランザクションは、[署名検証と二乗的なsighash計算][rusty megatx]によって検証に異常に長い時間を要しました。
攻撃者は、最後の署名以外はすべて有効な署名を作成し、ノードにトランザクションの検証に数分をかけさせ、
最後にそれがゴミであることがわかるようなものを作ることもできます。
その間、ノードは新しいブロックの処理を遅らせます。この種の攻撃は、
次のブロックで先手を打つために、競合するマイナーを標的にしていると想像できます。

非常に計算量の多いトランザクションの作業を回避するために、
Bitcoin Coreノードは、各トランザクションに対して、最大標準サイズと
最大署名操作数（または「sigops」）を課し、ブロックのコンセンサス制限よりも厳しく制限しています。
また、Bitcoin Coreノードは、祖先と子孫の両方のパッケージサイズに制限をかけることで、
ブロックテンプレートの作成と退去のアルゴリズムをより効果的にし、
トランザクションの祖先と子孫のセットを更新する必要があるmempoolの挿入と削除の
[計算量を制限しています][se descendant limits]。
これは、一部の正当なトランザクションが受理またはリレーされないことを意味しますが、
そのようなトランザクションは稀であることが予想されます。

これらは _トランザクションリレーポリシー_ の例で、
ノードが未承認トランザクションに適用する、コンセンサスに加えて行う一連の検証ルールです。

デフォルトでは、Bitcoin Coreノードは、1sat/vBの最小リレー手数料率（「minrelaytxfee」）を
下回るトランザクションを受け入れず、この要件を受け入れる前にいかなる署名も検証せず、
自分のmempoolに受け入れられない限りトランザクションをリレーしません。
ある意味、この手数料率ルールは、ネットワークの検証とリレーの最小「価格」を設定します。
マイニングを行わないノードは手数料を受け取ることはなく、
手数料はトランザクションを承認したマイナーにのみ支払われれます。
手数料が確認されるまでにネットワーク帯域幅の一部は既に使用されていますが、手数料は攻撃者にとってのコストになります。
検証とリレーを必要とするトランザクションを極端に多く送信する人は、やがて手数料を支払うお金がなくなります。

[Bitcoin Coreに][bitcoin core rbf docs]実装されている[Replace by Fee][topic rbf]ポリシーは、
置換トランザクションは直接競合する各トランザクションよりも高い手数料率を支払う必要があり、
置き換えられるすべてのトランザクションよりも高い総手数料を支払う必要があります。
追加の手数料を置換トランザクションの仮想サイズで割った値は、少なくとも1sat/vBでなければなりません。
言い換えれば、元のトランザクションと置換トランザクションの手数料率に関係なく、
新しいトランザクションは1sat/vBで独自の帯域幅のコストをカバーするために「新しい」手数料を支払わなければなりません。
この手数料ポリシーは、インセンティブの互換性に主眼を置いたものではありません。
むしろ、これにより、帯域幅を浪費する攻撃を抑制するために、
トランザクションを繰り返し置換する最小限のコストを発生させます
（たとえば、置換の度に1 satoshiだけ追加するようなもの）。

ブロックとトランザクションを完全に検証するノードは、メモリや計算リソース、ネットワーク帯域幅を含むリソースを必要とします。
ノードの実行を容易にし、ノードを攻撃から守るためには、必要なリソースを低く抑える必要があります。
一般的なDoS保護だけでは不十分なため、ノードは未承認トランザクションを検証する際に、
コンセンサスルールに加えてトランザクションリレーポリシーを適用します。
しかし、ポリシーはコンセンサスではないため、2つのノードが異なるポリシーを持っていても、
現在のチェーンの状態について合意することは可能です。来週の記事では、個人の選択としてのポリシーについて説明します。

[policy01]: /ja/newsletters/2023/05/17/#承認を待つ-1-なぜmempoolがあるのか
[max cpu tx]: https://bitcointalk.org/?topic=140078
[megatx mempool space]: https://mempool.space/tx/bb41a757f405890fb0f5856228e23b715702d714d59bf2b1feb70d8b2b4e3e08
[rusty megatx]: https://rusty.ozlabs.org/?p=522
[bitcoin core rbf docs]: https://github.com/bitcoin/bitcoin/blob/v25.0/doc/policy/mempool-replacements.md
[pr 6722]: https://github.com/bitcoin/bitcoin/pull/6722
[se descendant limits]: https://bitcoin.stackexchange.com/questions/118160/whats-the-governing-motivation-for-the-descendent-size-limit
