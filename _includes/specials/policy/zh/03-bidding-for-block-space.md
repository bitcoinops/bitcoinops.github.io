<!--
  300 to 1000 words
  put title in main newsletter
  put links in this file
  for any subheads use h3 (i.e., ###)
  illustrations welcome (max width 800px)
  if uncertain about anything, just do what seems best and harding will edit
-->

上周我们提到交易为已用的区块空间而不是转移的金额支付费用，并确定矿工优化他们的交易选择以最大化收取费用。因此，当找到一个块时，只有那些位于交易池头部的交易才会得到确认。在这篇文章中，我们将讨论获得最大收益的实用策略。让我们假设我们有一个不错的费率估算来源——我们将在下周的文章中更多地讨论费率估算。

在构建交易时，交易的某些部分比其他部分更灵活。每笔交易都需要头部字段，收款人输出由正在进行的付款决定，并且大多数交易都需要找零输出。发送方和接收方都应该更喜欢区块空间高效的输出类型，以减少未来花费交易输出的成本，但在[输入/硬币选择][topic coin selection]期间，更改交易的最终组成和重量的空间最大。由于交易按费率[费率/重量]竞争，较轻的交易需要较低的费用才能达到相同的费率。

一些钱包，例如 Bitcoin Core 钱包，尝试组合输入，这样它们就完全不需要找零输出。避免找零可以节省现在输出的重量，还可以节省以后花费找零输出的未来成本。不幸的是，除非钱包拥有种类繁多的大型 UTXO 池，否则这种输入组合很少可用。

现代输出类型比旧输出类型更节省块空间。例如，花费 P2TR 输入产生的重量不到 P2PKH 输入的 2/5。(使用我们的[交易规模计算器]试试吧！)对于多重签名钱包，最近完成的[MuSig2][topic musig] 模式和 FROST 协议通过允许多重签名功能以看起来像单签名输入的方式编码，节省了巨大的成本。特别是在区块空间需求飙升的时代，使用现代输出类型的钱包本身可以节省大量成本。

{:.center}
![Overview of input and output weights](/img/posts/specials/input-output-weights.png)

智能钱包根据费率改变其选择策略：在高费率下，它们使用很少的输入和现代输入类型来实现输入集的尽可能重量最低。始终选择最轻的输入集将在本地最小化当前交易的成本，但也会将钱包的 UTXO 池磨成小碎片。这可以让用户在以后以高费率进行具有大量输入集的交易。因此，对于钱包来说，以低费率选择更多和更重的输入是有先见之明的，以便在预期以后的区块空间需求高峰时机会主义地将资金整合到更少的现代输出中。

大容量钱包通常会将多个付款批处理到单个交易中，以减少每次付款的交易重量。它们不会产生头字节的开销和每次付款的找零输出，而是仅在所有付款之间共享后产生间接费用。即使只是批量处理几笔付款，也可以快速降低每次付款的成本。

![Savings from payment batching with
P2WPKH](/img/posts/payment-batching/p2wpkh-batching-cases-combined.png)

尽管如此，即使许多钱包估计费率因超额支付、交易提交缓慢或激增而出错，交易有时未经确认的时间也比计划的要长。在这些情况下，发送方或接收方可能希望重新确定交易的优先级。

用户通常有两种工具可以提高交易的优先级，即子代父偿([CPFP][topic cpfp])和手续费替换([RBF][topic rbf])。在 CPFP 中，用户花费其交易输出来创建高费率的子交易。正如上周的帖子中所描述的那样，矿工被激励将父母选入区块，以便包括收费高的孩子。CPFP 可供任何通过交易获得报酬的用户使用，因此接收方或发送方（如果他们创建了找零输出）都可以使用它。

在RBF中，发送者对原始交易进行更高费率的替换。替换交易必须重用原始交易中的至少一个输入，以确保与原始交易冲突，并且区块链中只能包含两个交易中的一个。通常，这种替换包括原始交易的付款，但发送者也可以将替换交易中的资金重新定向，或者在替换时将多个交易的付款合并为一个。正如上周的帖子所述，节点驱逐原始交易，以支持更具激励兼容的替换交易。

虽然区块空间的需求和生产都不在我们的控制范围内，但钱包可以使用许多技术来有效地竞标区块空间。钱包可以通过消除找零输出、花费本机隔离见证输出以及在低费率环境中对其 UTXO 池进行碎片整理来创建更轻的交易来节省费用。支持 CPFP 和 RBF 的钱包也可以从保守的费率开始，然后在需要时使用CPFP或RBF更新交易的优先级。

[transaction size calculator]: /en/tools/calc-size