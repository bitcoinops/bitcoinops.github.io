ある人が、その人の好きな数字を当てることができたら、特定の慈善団体に1,000 BTCを寄付すると申し出たとします。
寄付者がこれを実行する簡単な方法は、1,000 BTCを支払う未署名のトランザクションを作成し、
好きな数字を復号鍵として、そのトランザクションの署名を暗号化したコピーを公開する方法です。

理論的には、数字を推測した人は、署名を復号し、トランザクションをブロードキャストして慈善団体へ支払いができます。
しかし、寄付者がAESのような標準的な暗号化方式を使用している場合、
第三者が復号する前に署名がそのトランザクションに対して有効なものであることを簡単に知る方法はありません。
数字の推測に注力したい人は、寄付者がトロールではなく誠実であることを信頼しなければなりません。

この問題をもう少し拡張してみましょう。第三者であるアリスとボブは、署名が公開されるかどうかを賭けたいとします。
彼らは署名者に署名のハッシュを尋ね、それを[HTLC][topic htlc]関数内のハッシュとして使用することができますが、
これもまた寄付者が正直に行動することを信頼する必要があります。
最終的に署名が公開されたとしても、寄付者は誤ったハッシュをアリスとボブに与えることで、そのコントラクトを妨害することができます。

### アダプターの魔法

[署名アダプター（Signature adaptor）][topic adaptor signatures]は、
*アダプター署名（Adaptor signature）*や*one-time verifiably encrypted signature*とも呼ばれ、
これらの問題を解決するもので、Bitcoin上に構築されたプロダクションシステムで現在実際に直面している多くの問題を解決します。
Bitcoinの既存のECDSA署名方式でも使用可能ですが、
[BIP340][]で実装されているTaproot用の[Schnorr署名][topic schnorr signatures]と組み合わせることで、
アダプターを非公開でコストをかけずに使用することができます。
上の例が、アダプターを使うとどう変わるか見てみましょう。

先程と同様に、寄付者は1,000 BTCのトランザクションを用意します。
ほぼ通常の方法で署名しますが、1つの違いは、基本的に2つのnonceを生成する点です:
永久に秘密にしておく真のランダムnonceと、
もう１つは最初は秘密にしておくけど他の人が発見しても安全な好きな数字です。
寄付者は、これら2つの値を加算し1つのnonceであるかのようにして完全に有効な署名を作成します。

BIP340の署名コミットメントでは、nonceを2つの形式で使用します:
通常署名者のみが知っている数値表現（*スカラー*と呼ばれる）と、
検証を可能にするために公開される楕円曲線上の*点*です。

寄付者は、有効な署名コミットメント部を取り出し、隠されたスカラーを減算します。
これにより、署名は不完全（つまり無効）なものになりますが、
寄付者は（無効な）署名コミットメントと、完全なnonceの（有効な）点と、
隠された数字の（有効な）点を共有することができます。
これらの3つの情報を合わせて*署名アダプター*とします。

BIP340の署名検証アルゴリズムを少し変形し、
隠されたスカラーが（現在は無効な）署名コミットメントに単純に加算された場合、
署名アダプターが有効な署名を提供することを誰もが検証することができます。
これは隠された数字が何であるかを知らなくても検証できます。
要するに、ユーザーはトラストレスに隠されたスカラー値について推測することができるようになり、
正しい推測値により署名を取得しトランザクションを送信することができるという安心感が得られます。

寄付者の署名アダプターを受け取った他の人たちと同様に、アリスとボブは、
隠された数字の楕円曲線上の点のコピーを持っています。
また、他の人と同様、彼らは実際のスカラーを知りません。しかし、思い起こすと、
寄付者が有効な署名を無効な署名に変えるために行ったことは、
隠された数字の点に署名でコミットしながら、隠された数字を署名コミットメントから減算しただけでした。
アリスは、自分が知らないスカラーにコミットせず自分が知っている楕円曲線上の点にコミットすることで、
同じように簡単に（無効な）署名を作ることができます。
アリスは自分のnonceのペアを作り、（無効な）署名を作る際は秘密の形式を使用し、
寄付者の署名アダプターの楕円曲線の点とnonceの公開形式の集約にコミットします。
これにより、ボブに支払いをするトランザクションの署名アダプターが生成されます。
ボブがスカラーを知っていれば、アダプターを有効な署名に変換してトランザクションを送信し、
賭けに勝つことができます。

しかし、ボブはどうやって数字を知るのでしょうか？
数字を推測した誰かがプレスリリースをするのを待つのでしょうか？いいえ。
寄付者が公開した署名アダプターは、寄付者の実際の署名からスカラーを引いたものであることをもう一度思い出してください。
隠された数字が発見され、誰かが1,000 BTCのトランザクションを送信した場合、
彼らは元の（有効な）署名コミットメントを公開しなければなりません。
ボブは、（有効な）署名コミットメントを取得し、
そこから元の署名アダプターの（無効な）署名コミットメントを減算しスカラーを入手します。
続いて、そのスカラーを使ってアリスのアダプターを有効な署名に変換します。

### マルチシグアダプター

前節では、個々のユーザーが署名の作成方法を変更して署名アダプターを生成する方法を示しました。
[マルチシグ][topic multisignature]の参加者が同じトリックを使うことも可能です。
署名アダプターを使用する多くの場合、2人のユーザーの協力が必要となるため、これはとても便利です。

例えば、アリスとボブが上のような賭けをする場合、
二人はまず両者のマルチシグでのみ使用可能なスクリプトに資金をデポジットするところから始めるでしょう。
次にアリスは、署名アダプター形式の部分署名を生成できます。
ボブが隠された数字を知った場合、ボブがアリスのアダプターを有効なアリスの部分署名に変換し、
次にボブ自身の部分署名を提供して資金を使用できる完全な署名を作成することができます。

これにより、署名アダプターは一般的なマルチシグと同様の利点を持つことになります。
つまり、単一の署名のように見え、使用するスペースは同じで、手数料を最小限に抑え、
プライバシーとファンジビリティを最大限に高めることができます。

来週の*Taprootの準備*では、署名アダプターが使用されることが予想される主な方法の１つを紹介します。
Point Time Locked Contracts ([PTLC][topic ptlc])は、LNやcoinswap、
その他の多くのプロトコルで広く使われているHash Time Lock Contracts ([HTLC][topic htlc])をアップグレードしたものです。
