4年以上前にsegwitが有効になって以来、[bech32やbech32m][topic bech32]アドレスに対して
署名付きテキストメッセージを作成する広く受け入れられた方法はありません。
間違いなく、これは広範なメッセージ署名のサポートが、ユーザーや開発者にとってそれほど重要ではないことを意味し、
そうでなければ、もっと多くの作業がそれに費やされていることでしょう。
しかし、誰もがレガシーアドレスを使い、署名されたメッセージを簡単に交換できた時代から、
Bitcoinウォレットソフトウェアは後退したように感じます。

約2年前に[bech32支払いのサポート][bech32ss signmessage]シリーズで書いた
[汎用的なsignmessage][topic generic signmessage]ソリューションは低迷しており、
プロトコルドキュメントである[BIP322][]が時折更新されているにもかかわらず
（ニュースレター[#118][news118 virttx]および[#130][news130 inconclusive]参照）、
Bitcoin Coreには採用されませんでした。
それにもかかわらず、私たちはこれ以上の代替案を知らないため、
P2TRウォレットにsignmessageサポートを追加したい開発者にとっては、
BIP322が依然として好ましい選択であるはずです。

実装されている場合、汎用のsignmessageは、P2TRアウトプットに対して、
シングルシグや[マルチシグ][topic multisignature]、または任意の[Tapscript][topic tapscript]を使用して
メッセージに署名できるようにします。
また、すべてのレガシーアドレスおよびbech32アドレスとの後方互換性と、
近い将来に想定されている変更（そのうちのいくつかは、今後の*Taprootの準備*コラムで紹介します）との前方互換性も提供されます。
完全なUTXOセットにアクセスできるアプリケーション（例: フルノード経由）は、
BIP322を使用して[リザーブ・プルーフ][bip322 reserve proofs]を生成・検証することもできます。
これは、署名者がある時点で一定量のビットコインを管理していたことを証明するものです。

汎用的な署名付きメッセージを作成するためのサポートは、非常に簡単に実装できるでしょう。
BIP322では、*仮想トランザクション*と呼ばれる技術を使っています。
最初の仮想トランザクションは、存在しない前のトランザクション（txidがすべてゼロのトランザクション）から支払いしようとすることで、
意図的に無効になるように作成されます。この最初のトランザクションは、
ユーザーが署名したいアドレス（スクリプト）に支払い、希望するメッセージのハッシュコミットメントを含みます。
2つめのトランザクションは、最初のトランザクションのアウトプットを使用します。
その支払いの署名およびその他のデータが有効なトランザクションであれば、
メッセージは署名されているとみなされます（ただし、2つめの仮想トランザクションは、
無効なトランザクションを参照しているため、オンチェーンに含めることはできません）。

汎用的な署名付きメッセージを検証することは、多くのウォレットにとって困難です。
*任意の*BIP322メッセージを完全に検証できるようにするには、
基本的にすべてのBitcoinのコンセンサスルールを実装する必要があります。
ほとんどのウォレットではそれを行っていないため、BIP322ではScriptを完全に検証できない場合に
「不確定」な状態を返すことができます。
実際には、特にTaprootがkeypathの支払いを奨励している場合、それは稀なことかもしれません。
最もよく使われるScriptタイプのいくつかを実装したウォレットであれば、
全UTXOの99%以上の署名付きメッセージを検証することができます。

汎用的なsignmessageのサポートはBitcoinの有用な追加機能になるでしょう。
ここ数年、注意が払われてこなかったことを無視することはできませんが、
これを読んでいるウォレット開発者には、プログラムに実験的なサポートを追加することの検討をお勧めします。
これは、ここ数年ユーザーが失っていた機能をユーザーに提供する簡単な方法です。
BIP322や関連するリザーブ・プルーフの実装に取り組んでいる開発者の方や、
このような機能が有用であると思われるサービスプロバイダーの方は、
[info@bitcoinops.org][optech email]までお気軽に連絡いただき、取り組みを調整ください。

[reserve proofs]: https://github.com/bitcoin/bips/blob/master/bip-0322.mediawiki#full-proof-of-funds
[bech32ss signmessage]: /en/bech32-sending-support/#message-signing-support
[bip322 reserve proofs]: https://github.com/bitcoin/bips/blob/master/bip-0322.mediawiki#full-proof-of-funds
[news118 virttx]: /en/newsletters/2020/10/07/#alternative-to-bip322-generic-signmessage
[news130 inconclusive]: /en/newsletters/2021/01/06/#proposed-updates-to-generic-signmessage
